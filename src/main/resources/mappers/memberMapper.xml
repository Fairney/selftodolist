<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">
	<resultMap type = "member" id = "member_rm">
		<id property = "memberNo" column = "MEMBER_NO"/>
		<result property = "memberId" column = "MEMBER_ID"/>
		<result property = "memberPw" column = "MEMBER_PW"/>
		<result property = "socialType" column = "SOCIAL_TYPE"/>
		<result property = "memberAddr" column = "MEMBER_ADDR"/>
		<result property = "memberEmail" column = "MEMBER_EMAIL"/>
		<result property = "secessionFl" column = "SECESSION_FL"/>
	</resultMap>
	
	<select id = "idDupCheck" parameterType = "string" resultType = "_int">
		SELECT COUNT(MEMBER_ID)
		FROM MEMBER
		WHERE MEMBER_ID = #{memberId}
	</select>
	
	<select id = "nickDupCheck" parameterType = "string" resultType = "_int">
		SELECT COUNT(MEMBER_NICK)
		FROM MEMBER
		WHERE MEMBER_NICK = #{memberNick}
	</select>
	<select id = "emailDupCheck" parameterType = "string" resultType = "_int">
		SELECT COUNT(MEMBER_EMAIL)
		FROM MEMBER
		WHERE MEMBER_EMAIL = #{memberEmail}
	</select>
	
	<insert id = "signUp" parameterType = "member">
	INSERT
	INTO MEMBER(MEMBER_ID, MEMBER_PW, SOCIAL_TYPE,MEMBER_EMAIL,MEMBER_NICK,MEMBER_ADDR,SECESSION_FL)
	VALUES(
		#{memberId},
		#{memberPw},
		'N',
		#{memberEmail},
		#{memberNick},
		#{memberAddr},
		'N'
	)
	</insert>
	<select id ="login" parameterType = "member" resultMap = "member_rm">
	SELECT *
	FROM MEMBER
	WHERE MEMBER_ID = #{memberId}
	</select>
	<select id = "selectApiMemberCount" parameterType = "member"  resultType = "_int">
	SELECT COUNT(MEMBER_ID)
	FROM MEMBER
	WHERE MEMBER_ID = #{memberId}
	AND SOCIAL_TYPE = #{socialType}
	AND SECESSION_FL = 'N'
	</select>
	<select id = "selectApiMember" parameterType = "member" resultMap = "member_rm">
	SELECT *
	FROM MEMBER
	WHERE MEMBER_ID = #{memberId}
	AND
		<choose>
			<when test='socialType = "google"'>
				SOCIAL_TYPE = 'google'
			</when>
			<when test='socialType = "kakao"'>
				SOCIAL_TYPE = 'KA'
			</when>
			<otherwise>
				SOCIAL_TYPE = 'N'
			</otherwise>
		</choose>
	</select>
	<insert id = "snssignUp" parameterType = "member">
	INSERT
	INTO MEMBER(MEMBER_ID, MEMBER_PW, SOCIAL_TYPE,MEMBER_EMAIL,MEMBER_NICK,MEMBER_ADDR,SECESSION_FL)
	<choose>
		<when test = 'socialType = "google"'>
		VALUES(
		#{memberId},
		#{memberPw},
		'google',
		#{memberId},
		#{memberNick},
		#{memberAddr},
		'N'
	)
		</when>
		<when test = 'socialType = "kakao"'>
		VALUES(
		#{memberId},
		#{memberPw},
		'kakao',
		#{memberId},
		#{memberNick},
		#{memberAddr},
		'N'
	)
		</when>
		<when test = 'socialType = "N"'>
		VALUES(
		#{memberId},
		#{memberPw},
		'N',
		#{memberId},
		#{memberNick},
		#{memberAddr},
		'N'
	)
		</when>
	</choose>
	</insert>
	
</mapper>
